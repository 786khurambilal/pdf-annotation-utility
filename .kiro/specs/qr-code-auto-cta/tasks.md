# Implementation Plan

- [x] 1. Set up QR code detection infrastructure
  - Install jsQR library for QR code scanning functionality
  - Create QRCodeScanner service with canvas-based detection methods
  - Implement QR code detection validation and error handling
  - Write unit tests for QR code scanning accuracy and edge cases
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 2. Extend CallToAction data model for auto-generation
  - Add isAutoGenerated, qrCodeContent, and autoGeneratedAt fields to CallToAction interface
  - Update CallToAction validation functions to handle new optional fields
  - Modify createCallToAction helper to support auto-generated flag
  - Update existing CTA components to handle auto-generated CTAs
  - Write unit tests for extended CallToAction model validation
  - _Requirements: 2.1, 2.2, 4.1, 4.2, 7.1, 7.2_

- [x] 3. Implement page content extraction for heading detection
  - Create PageContentExtractor utility using pdf-lib for text extraction
  - Implement heading detection based on font size, weight, and positioning
  - Add method to find best heading near QR code coordinates
  - Create fallback title generation for pages without clear headings
  - Write unit tests for heading extraction with various PDF structures
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 4. Build AutoCTAGenerator factory for QR-based CTAs
  - Create AutoCTAGenerator class with configurable base URL ("http://test.com/")
  - Implement URL generation logic combining base URL with QR code content
  - Add title generation using page headings with character limit (50 chars)
  - Handle different QR code content types (URLs vs text)
  - Write unit tests for CTA generation with various QR code inputs
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 5. Create QR scanning state management system
  - Implement QRScanningManager for orchestrating the scanning process
  - Add QRScanningState interface with progress tracking and error handling
  - Create state change notification system for UI updates
  - Implement pause/resume functionality for performance management
  - Write unit tests for scanning state management and error scenarios
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 6. Integrate QR scanning with PDF upload workflow
  - Hook QR scanning into existing PDF upload and processing pipeline
  - Implement background scanning using Web Workers or requestIdleCallback
  - Add scanning trigger after PDF successfully loads and renders
  - Coordinate with existing react-pdf canvas rendering for QR detection
  - Write integration tests for PDF upload with QR code detection
  - _Requirements: 1.1, 1.2, 6.1, 6.4, 7.3, 7.4_

- [x] 7. Build user settings for QR code auto-detection
  - Create QRCodeSettings interface with enable/disable and configuration options
  - Implement settings persistence using existing localStorage patterns
  - Add settings UI components for user control over QR scanning
  - Create default configuration with "http://test.com/" base URL
  - Write unit tests for settings management and persistence
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 8. Implement visual distinction for auto-generated CTAs
  - Add visual indicators to distinguish auto-generated CTAs in UI components
  - Update CTAList component to group and label auto-generated CTAs
  - Implement tooltip showing QR code origin for auto-generated CTAs
  - Add consistent styling for auto-generated CTA markers
  - Write unit tests for visual distinction rendering
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 9. Add CTA management features for auto-generated items
  - Enable editing of auto-generated CTA titles and URLs
  - Implement status change from auto-generated to manual when edited
  - Add deletion functionality for auto-generated CTAs
  - Prevent duplication of auto-generated CTAs on re-upload
  - Write unit tests for auto-generated CTA management operations
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 10. Create progress indication and user feedback system
  - Implement scanning progress indicator in PDF viewer interface
  - Add notification system for completed QR code scans
  - Create user feedback for found QR codes and generated CTAs
  - Implement error messaging for scanning failures
  - Write unit tests for progress indication and notification systems
  - _Requirements: 6.1, 6.2, 6.3, 6.5_

- [x] 11. Integrate with existing annotation context and storage
  - Update AnnotationContext to handle auto-generated CTAs
  - Modify annotation storage to include auto-generation metadata
  - Ensure user isolation for auto-generated CTAs
  - Integrate with existing annotation export/backup functionality
  - Write integration tests for annotation context with auto-generated CTAs
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 12. Implement performance optimizations and error handling
  - Add memory management for canvas processing and QR detection
  - Implement timeout handling for individual page scans
  - Create error recovery strategies for failed QR detections
  - Add performance monitoring and scanning limits
  - Write performance tests for large PDFs with multiple QR codes
  - _Requirements: 6.1, 6.4, 6.5, 6.6_

- [x] 13. Add comprehensive error handling and user guidance
  - Implement graceful degradation when QR detection is not supported
  - Create user-friendly error messages for scanning failures
  - Add logging system for QR detection errors and debugging
  - Implement fallback behavior when scanning partially fails
  - Write unit tests for error handling scenarios and user messaging
  - _Requirements: 1.3, 6.3, 6.5, 6.6_

- [x] 14. Create end-to-end integration tests
  - Write integration tests for complete QR code detection workflow
  - Test PDF upload with QR codes through CTA creation
  - Verify user settings integration with scanning behavior
  - Test error scenarios with corrupted PDFs and invalid QR codes
  - Create browser compatibility tests for QR detection functionality
  - _Requirements: All requirements integration testing_